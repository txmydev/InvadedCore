package invaded.cc.core.listener;

import dev.luzifer.log4jexploitfix.events.PlayerMaliciousChatEvent;
import invaded.cc.core.util.CC;
import invaded.cc.core.util.Common;
import invaded.cc.core.util.Countdown;
import invaded.cc.core.util.perms.PermLevel;
import org.bukkit.Bukkit;
import org.bukkit.entity.Player;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;

public class ExploitListener implements Listener {

    @EventHandler
    public void onExploit(PlayerMaliciousChatEvent event) {
        Player player = event.getPlayer();
        player.sendMessage(CC.RED + "Mal ahi amigo, casi te sale!");
        String name = player.getName();

        Common.broadcastMessage(PermLevel.STAFF, " ");
        Common.broadcastMessage(PermLevel.STAFF, player.getDisplayName() + " &ctried to exploit the server, he's getting banned in 10 seconds LMFAOO");
        Common.broadcastMessage(PermLevel.STAFF, " ");

        Countdown
                .build()
                .setTimer(10)
                .setPeriod(20L)
                .setStartDelay(0L)
                .setTick((timer) -> {
                    player.sendMessage(CC.RED + "Te vas a ir en " + timer);
                })
                .setFinish(() -> Bukkit.getServer().dispatchCommand(Bukkit.getConsoleSender(), "blacklist " + name))
                .execute();

      /*  new BukkitRunnable(){

            private int timer = 10;

            @Override
            public void run() {
                if(timer <= 0 || !player.isOnline()) {
                    cancel();

                    return;
                }

                timer--;

            }
        }.runTaskTimerAsynchronously(Spotify.getInstance(), 0L, 20L); */
    }

}
